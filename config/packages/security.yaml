security:
    # ============================================================
    # ğŸ” HASHAGE DES MOTS DE PASSE
    # ============================================================
    # Symfony choisit automatiquement lâ€™algorithme le plus sÃ»r
    password_hashers:
        App\Entity\User:
            algorithm: auto


    # ============================================================
    # ğŸ‘¤ PROVIDER UTILISATEUR
    # ============================================================
    # DÃ©finit comment Symfony retrouve un utilisateur
    providers:
        app_user_provider:
            entity:
                class: App\Entity\User
                property: email


    # ============================================================
    # ğŸ”¥ FIREWALLS
    # ============================================================
    firewalls:

        # ----------------------------
        # ğŸ”“ ROUTES DEV / DEBUG
        # ----------------------------
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false


        # ----------------------------
        # ğŸ”“ SWAGGER / DOC API
        # ----------------------------
        swagger:
            pattern: ^/api/docs
            stateless: true
            security: false


        # ----------------------------
        # ğŸ” AUTHENTIFICATION (LOGIN)
        # ----------------------------
        # ReÃ§oit email + password
        # GÃ©nÃ¨re un JWT si succÃ¨s
        login:
            pattern: ^/api/login
            stateless: true
            json_login:
                check_path: /api/login_check
                username_path: email
                password_path: password
                success_handler: lexik_jwt_authentication.handler.authentication_success
                failure_handler: lexik_jwt_authentication.handler.authentication_failure


        # ----------------------------
        # ğŸ” FIREWALL PRINCIPAL API
        # ----------------------------
        # Toutes les routes /api/**
        # JWT obligatoire par dÃ©faut
        api:
            pattern: ^/api
            stateless: true
            jwt: ~


    # ============================================================
    # ğŸš¦ CONTRÃ”LE Dâ€™ACCÃˆS (QUI A LE DROIT)
    # ============================================================
    # âš ï¸ Lâ€™ordre est IMPORTANT (du plus spÃ©cifique au plus gÃ©nÃ©ral)
    access_control:

        # ğŸ”“ PUBLIC : crÃ©ation de compte
        - { path: ^/api/register, roles: PUBLIC_ACCESS }

        # ğŸ”“ PUBLIC : login (JWT)
        - { path: ^/api/login_check, roles: PUBLIC_ACCESS }

        # ğŸ”“ PUBLIC : vÃ©rification email (token unique)
        - { path: ^/api/verify-email, roles: PUBLIC_ACCESS }
        - { path: ^/api/verify-email/resend, roles: PUBLIC_ACCESS }

        # ğŸ”“ PUBLIC : mot de passe oubliÃ© / reset
        - { path: ^/api/password/request, roles: PUBLIC_ACCESS }
        - { path: ^/api/password/reset, roles: PUBLIC_ACCESS }

        # ğŸ”’ PRIVÃ‰ : tout le reste de lâ€™API
        - { path: ^/api, roles: IS_AUTHENTICATED_FULLY }
        


