security:
    # ============================================================
    # üîê HASHAGE DES MOTS DE PASSE
    # ============================================================
    # Symfony choisit automatiquement l‚Äôalgorithme le plus s√ªr
    password_hashers:
        App\Entity\User:
            algorithm: auto


    # ============================================================
    # üë§ PROVIDER UTILISATEUR
    # ============================================================
    # D√©finit comment Symfony retrouve un utilisateur
    providers:
        app_user_provider:
            entity:
                class: App\Entity\User
                property: email


    # ============================================================
    # üî• FIREWALLS
    # ============================================================
    firewalls:

        # ----------------------------
        # üîì ROUTES DEV / DEBUG
        # ----------------------------
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false


        # ----------------------------
        # üîì SWAGGER / DOC API
        # ----------------------------
        swagger:
            pattern: ^/api/docs
            stateless: true
            security: false


        # ----------------------------
        # üîê AUTHENTIFICATION (LOGIN)
        # ----------------------------
        # Re√ßoit email + password
        # G√©n√®re un JWT si succ√®s
        login:
            pattern: ^/api/login
            stateless: true
            json_login:
                check_path: /api/login_check
                username_path: email
                password_path: password
                success_handler: lexik_jwt_authentication.handler.authentication_success
                failure_handler: lexik_jwt_authentication.handler.authentication_failure


        # ----------------------------
        # üîê FIREWALL PRINCIPAL API
        # ----------------------------
        # Toutes les routes /api/**
        # JWT obligatoire par d√©faut
        api:
            pattern: ^/api
            stateless: true
            jwt: ~


    # ============================================================
    # üö¶ CONTR√îLE D‚ÄôACC√àS (QUI A LE DROIT)
    # ============================================================
    # ‚ö†Ô∏è L‚Äôordre est IMPORTANT (du plus sp√©cifique au plus g√©n√©ral)
    access_control:

        # üîì PUBLIC : cr√©ation de compte
        - { path: ^/api/register, roles: PUBLIC_ACCESS }

        # üîì PUBLIC : login (JWT)
        - { path: ^/api/login_check, roles: PUBLIC_ACCESS }

        # üîì PUBLIC : v√©rification email (token unique)
        - { path: ^/api/verify-email, roles: PUBLIC_ACCESS }
        - { path: ^/api/verify-email/resend, roles: PUBLIC_ACCESS }

        # üîì PUBLIC : mot de passe oubli√© / reset
        - { path: ^/api/password/request, roles: PUBLIC_ACCESS }
        - { path: ^/api/password/reset, roles: PUBLIC_ACCESS }

        # üîì PUBLIC : OAuth Google
        - { path: ^/auth/google, roles: PUBLIC_ACCESS }

        # üîí PRIV√â : tout le reste de l‚ÄôAPI
        - { path: ^/api, roles: IS_AUTHENTICATED_FULLY }
        
        # ADMIN : User avec role_ADMIN
        - { path: ^/api, roles: IS_AUTHENTICATED_FULLY }


