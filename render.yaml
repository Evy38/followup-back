# ===============================================
# üöÄ Configuration Render - FollowUp Backend
# ===============================================
# Infrastructure as Code pour le d√©ploiement

services:
  # Service Web - Backend Symfony
  # -----------------------------------------------
  - type: web
    name: followup-backend
    runtime: docker
    dockerfilePath: ./Dockerfile.render
    region: frankfurt  # EU (proche de la France)
    plan: free  # Plan gratuit
    
    # Branche √† d√©ployer
    branch: main
    
    # Health check pour v√©rifier que l'app tourne
    healthCheckPath: /health
    
    # ‚ö†Ô∏è Les migrations doivent √™tre configur√©es dans le Dockerfile ou via le dashboard Render
    
    # Variables d'environnement
    envVars:
      # ===== Symfony Core =====
      - key: APP_ENV
        value: prod
      
      - key: APP_DEBUG
        value: 0
      
      - key: APP_SECRET
        generateValue: true  # G√©n√®re un secret al√©atoire s√©curis√©
      
      # ===== Base de donn√©es PostgreSQL =====
      # Render va automatiquement cr√©er cette variable avec l'URL de la DB
      - key: DATABASE_URL
        fromDatabase:
          name: followup-db
          property: connectionString
      
      # ===== JWT Authentication =====
      - key: JWT_SECRET_KEY
        value: /var/www/html/config/jwt/private.pem
      
      - key: JWT_PUBLIC_KEY
        value: /var/www/html/config/jwt/public.pem
      
      - key: JWT_PASSPHRASE
        sync: false  # √Ä configurer manuellement dans le dashboard Render
      
      # ===== CORS =====
      - key: CORS_ALLOW_ORIGIN
        sync: false  # URL du frontend (√† d√©finir apr√®s d√©ploiement front)
      
      # ===== URLs Frontend =====
      - key: FRONTEND_URL
        sync: false  # URL du frontend d√©ploy√©
      
      - key: FRONT_URL
        sync: false  # M√™me valeur que FRONTEND_URL
      
      # ===== Messenger (synchrone en prod pour commencer) =====
      - key: MESSENGER_TRANSPORT_DSN
        value: sync://
      
      # ===== OAuth Google =====
      - key: GOOGLE_CLIENT_ID
        sync: false  # Tes credentials Google (√† mettre dans le dashboard)
      
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      
      - key: GOOGLE_REDIRECT_URI
        sync: false  # URL de callback (https://ton-backend.onrender.com/auth/google/callback)
      
      # ===== Mailer (Gmail en prod) =====
      - key: MAILER_DSN
        sync: false  # Ton MAILER_DSN Gmail
      
      # ===== API Adzuna =====
      - key: ADZUNA_APP_ID
        value: 27d622d1
      
      - key: ADZUNA_APP_KEY
        value: 6f4fa54fa72e6fc3dbcb2742c1b262b1
      
      - key: ADZUNA_COUNTRY
        value: fr
      
      # ===== Redis Cloud (OBLIGATOIRE) =====
      # ‚úÖ √Ä configurer dans le dashboard Render
      - key: REDIS_URL
        sync: false  # Configurer manuellement : redis://user:password@host:port

# -----------------------------------------------
# Base de donn√©es PostgreSQL
# -----------------------------------------------
databases:
  - name: followup-db
    databaseName: followup_production
    user: followup_user
    plan: free  # Plan gratuit (max 90 jours d'inactivit√© avant suppression)
    region: frankfurt  # M√™me r√©gion que le backend pour la latence